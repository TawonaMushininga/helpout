# API Docs

## Generating Docs
Docs are autogenerated based off of the requests specs, no extra code is needed.

To update docs:

1. Once you finished adding/changing/removing files in `spec/requests/api`
2. Update docs file

    2.a. We use parallelization by default to speed up the process:
    ```bash
    bin/update-docs.rb
    ```
    2.b. Without parallelization
    ```bash
    SEQUENTIAL_SPECS=true bin/update-docs.rb
    ```
3. Commit changes

## Checking Docs
A [check-docs](./.github/workflows/ci.yml) step is provided in the CI action to check the request specs pass and the docs don't have missing changes.

This action is triggered when the PR is labeled with `api_docs` and on pushes to main.
An autolabeler action takes care of labeling for any PR that changes the `spec/requests/api` files, but if you wish to run this against any PR just add the label manually.

### Removing CI action
If you wish not to have a specific check for docs in the CI you can just modify the file and remove the [check-docs](./.github/workflows/ci.yml) job.
### Parallelization caveats
We use a default of 8 cores locally and in the workflow, if you wish to change this just update the workflow to the desired amount, if not you will have data changes in the generated docs.
```bash
PARALLEL_TESTS_CONCURRENCY=2 bin/update-docs.rb
```

If you wish to run everything without parallelization make the following change:
```diff
  name: Setup Database
- run: bundle exec rake parallel:load_schema[8]
+ run: bundle exec rails db:setup
  name: Run tests and update docs
  env:
-   PARALLEL_TESTS_CONCURRENCY: 8
+   SEQUENTIAL_SPECS: true
  run: bundle exec ./bin/update-docs.rb && git diff
```
